System Design социальной сети для курса по System Design – https://balun.courses/courses/system_design?ysclid=mgnt2uxqdd770961050

Функциональные требования:

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;


Нефункциональные требования:
Время отклика:
   - Создание поста - 5 с.;
   - Оценка поста - 1 с.;
   - Добавление комментария к посту - 2 с.;
   - Получение ленты постов - 3 с.;
   - Получение комментариев к посту - 2 с.;
   - Получение фотографий поста - 3 с.;
   - Получение оценок поста - 500 мс.

10 000 000 DAU
Приложение:
	- веб;
	- мобильное
Геораспределенность: страны СНГ
Доступность: 99,9%
Сезонность: высокий сезон - лето/зима, низкий сезон - межсезонье (в высокий сезон множитель - х2)
Максимальное количество подписчиков у пользователя: 1 000 000
Данные храним - всегда


Типы пользователей:

- наблюдатели - 90% (просматривают ленту и фото, ставят лайки, контент не создают);
- умеренные авторы - 9% (периодически публикуют посты, активно лайкают, комментируют и подписываются на других путешественников);
- активные авторы - 1% (публикуют посты часто, активно комментируют)

Расчеты:
Фотографий в посте - 5;
Размер фотографии - 2 МБ;
Количество символов в посте - 3 000 (3 КБ)
Средний размер медиа для поста: 5 фото * 2 МБ = 10 МБ
Средний размер метаданных поста - 10 КБ

RPS. Просмотр ленты
Наблюдатели - 15 запросов в день
Умеренные авторы - 25 запросов в день
Активные авторы - 40 запросов в день
Итого количество запросов в день: 0.9*15 + 0.09*25 + 0.01*40 = ~16 запросов в день
RPS = 10 000 000 * 16 / 86 400 = ~1 852

Трафик. Просмотр ленты (мета)
1 852 * 10КБ = 18 520 КБ/с 

Трафик. Просмотр ленты (медиа)
1 852 * 1.2МБ = 2 222 МБ/с


RPS. Поиск и просмотр постов/мест

Наблюдатели - 10 запросов в день
Умеренные авторы - 20 запросов в день
Активные авторы - 30 запросов в день
Итого количество запросов в день: 0.9*10 + 0.09*20 + 0.01*30 = ~11 запросов в день
RPS = 10 000 000 * 11 / 86 400 = ~1 273

Трафик. Поиск и просмотр постов/мест (мета)
1 273 * 7КБ = 8 911 КБ/с 


Трафик. Поиск и просмотр постов/мест (медиа)
1 273 * 3МБ = 3 819 МБ/с


RPS. Подписки
Наблюдатели - 0.25 запроса в день
Умеренные авторы - 1 запрос в день
Активные авторы - 2 запроса в день
Итого количество запросов в день: 0.9*0.25 + 0.09*1 + 0.01*2 = ~0,4 запроса в день
RPS = 10 000 000 * 0.4 / 86 400 = ~47

Трафик. Подписки
47 * 1КБ = 47 КБ/с 


RPS. Лайки/комментарии
Наблюдатели - 5 запросов в день
Умеренные авторы - 10 запросов в день
Активные авторы - 20 запросов в день
Итого количество запросов в день: 0.9*5 + 0.09*10 + 0.01*20 = ~6 запросов в день
RPS = 10 000 000 * 6 / 86 400 = ~695

Трафик. Лайки/комментарии
695 * 3КБ =  2 085КБ/с 


RPS. Публикация постов
Наблюдатели - 0 запросов в день
Умеренные авторы - 3 запроса в день
Активные авторы - 5 запросов в день
Итого количество запросов в день: 0.9*0 + 0.09*3 + 0.01*5 = ~0,4 запросов в день
RPS = 10 000 000 * 0.4 / 86 400 = ~47

Трафик. Публикация постов (мета)
47 * 6КБ = 282 КБ/с 


Трафик. Публикация постов (медиа)
47 * 10МБ = 470 МБ/с

Расчет одновременных соединений
Connections = 10 000 000 * 0.1 = 1 000 000 

Посты.

Трафик. Публикация постов (мета) - 0,14 МБ/с
Трафик. Просмотр ленты (мета) - 18 МБ/с
Трафик. Поиск и просмотр постов/мест (мета) - 9 МБ/с

Capacity = 0,14 МБ/с * 86 400 * 365 = 4,415 ТБ
SSD:
Disk_for_capacity =  4,415 ТБ/ 90 ТБ = 0,05  
Disks_for_throughput = 28 / 500 МБ/с = 0,06 
Disks_for_iops = 47 / 1 000 = 0,047
Disks max (0,05, 0,06, 0,047) = 1

Трафик. Публикация постов (медиа) - 470 МБ/с
Трафик. Просмотр ленты (медиа) - 2 222 МБ/с 
Трафик. Поиск и просмотр постов/мест (медиа) - 3 819 МБ/с

Capacity = 470 МБ/с * 86 400 * 365 = 14 822 ТБ
SSD:
Disk_for_capacity =  14 822 ТБ/ 90 ТБ = 165  
Disks_for_throughput = 6 511 / 500 МБ/с = 13 
Disks_for_iops = 47 / 1 000 = 0,047
Disks max (165, 13, 0,047) = 165

Реакции.

Трафик. Создание комментария - 0,04 МБ/с
Трафик. Чтение комментария - 0,36 МБ/с

Capacity = 0,04 МБ/с * 86 400 * 365 = 1,3 ТБ
SSD:
Disk_for_capacity =  1,3 ТБ/ 1 ТБ = 1,3  
Disks_for_throughput = 0,4 / 500 МБ/с = 0,0008 
Disks_for_iops = 556 / 1 000 = 0,556
Disks max (1,3, 0,0008, 0,556) = 1

Комментарии.

Трафик. Создание лайка - 0,16 МБ/с
Трафик. Чтение лайка - 1,44 МБ/с

Capacity = 0,16 МБ/с * 86 400 * 365 = 5 ТБ
SSD:
Disk_for_capacity =  5 ТБ/ 2 ТБ = 2,5  
Disks_for_throughput = 1,6 / 500 МБ/с = 0,0032 
Disks_for_iops = 139 / 1 000 = 0,139
Disks max (2,5, 0,0032, 0,136) = 3

Расчёт хостов (на 1 год, с репликацией):
Посты (мета)
Hosts = 1/1 = 1
Hosts_with_replication = 1 * 3 = 3

Посты (медиа)
Hosts = 165/1 = 165
Hosts_with_replication = 165 * 3 = 495
Для старых постов можно снизить replication factor до 2, чтобы сократить хосты на 30-50%

Комментарии
Hosts = 3/1 = 1 
Hosts_with_replication = 1 * 3 = 3 

Реакции
Hosts = 1/1 = 1 
Hosts_with_replication =1 * 3 = 3

![System context diagram](social_network_system_design/images/context.png)

